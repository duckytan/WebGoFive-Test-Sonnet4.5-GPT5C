# H5 五子棋 UI 设计与交互规范

> 版本：1.0  
> 适用对象：前端开发、UI 设计、交互设计  
> 参考：旧项目 v1.0.3 UI 实现

---

## 1. 整体布局规范

### 1.1 页面结构
```
┌─────────────────────────────────────────────────────┐
│  Header: 标题 + 版本徽章 + 工具按钮(提示/设置/帮助)   │
├─────────────────────────────────────────────────────┤
│  ┌────────────┐  ┌────────────────────────────┐    │
│  │ 左侧面板   │  │     中央棋盘区域            │    │
│  │ - 当前玩家 │  │  ┌──────────────────┐     │    │
│  │ - 游戏状态 │  │  │   Canvas 棋盘    │     │    │
│  │ - 控制按钮 │  │  │   600×600        │     │    │
│  │ - AI设置   │  │  └──────────────────┘     │    │
│  │ (动态显示) │  │     提示信息区               │    │
│  └────────────┘  └────────────────────────────┘    │
├─────────────────────────────────────────────────────┤
│  Footer: 回放控制器（仅回放模式时显示）              │
└─────────────────────────────────────────────────────┘
```

### 1.2 响应式设计
| 屏幕尺寸 | 布局调整 |
|----------|----------|
| > 1024px | 标准布局：左侧面板+中央棋盘并排 |
| 768-1024px | 左侧面板宽度缩窄，棋盘居中 |
| < 768px | 左侧面板折叠为抽屉，棋盘占据主要区域 |

---

## 2. 视觉设计规范

### 2.1 颜色系统
| 用途 | 颜色值 | 说明 |
|------|--------|------|
| 棋盘背景 | `#f4e4bc` | 木质质感 |
| 棋盘线条 | `#8b6f47` | 深棕色 |
| 黑棋 | `#2f2f2f` | 近黑色 |
| 白棋 | `#f0f0f0` | 乳白色 |
| 主按钮 | `#4caf50` | 绿色（行动召唤） |
| 次要按钮 | `#9e9e9e` | 灰色 |
| 禁用按钮 | `#e0e0e0` | 浅灰色 |
| 错误提示 | `#d32f2f` | 红色 |
| 警告提示 | `#f57c00` | 橙色 |
| 成功提示 | `#388e3c` | 深绿色 |
| 信息提示 | `#1976d2` | 蓝色 |

### 2.2 字体与排版
- 主标题：`font-size: 2em; font-weight: 700`
- 正文：`font-size: 1rem; line-height: 1.5`
- 按钮文字：`font-size: 0.9rem; font-weight: 500`
- 提示信息：`font-size: 0.85rem; font-style: italic`

### 2.3 间距系统（8px 网格）
- 微间距：8px
- 小间距：16px
- 中间距：24px
- 大间距：32px
- 特大间距：48px

---

## 3. 核心组件设计

### 3.1 Canvas 棋盘
**尺寸**：600×600px（可缩放）  
**核心元素**：
- 网格线：15×15，单元格 36px
- 边距：30px
- 天元标记：实心圆点
- 星位标记：(3,3) (3,11) (11,3) (11,11) (7,7)

**交互状态**：
| 状态 | 视觉反馈 |
|------|-----------|
| 悬停预览 | 半透明圆圈，跟随鼠标移动 |
| 最后落子 | 黑棋：金色光晕（rgba(255,215,0,0.6)），白棋：粉色光晕（rgba(255,105,180,0.6)） |
| AI 建议 | 绿色虚线圆圈 + 十字标记 |
| 禁手高亮 | 红色边框 + 半透明填充 |

### 3.2 当前玩家指示器
```html
<div class="current-player">
  <div class="piece piece--black"></div>
  <span class="player-name">黑棋先手</span>
</div>
```
- 动态更新棋子颜色与文案
- EvE 模式下显示 "黑方 AI" / "白方 AI"

### 3.3 游戏状态面板
**显示内容**：
- 模式：`人机对战 (正常)` / `机机对战 (黑:困难 vs 白:地狱)`
- 回合：`第 12 回合`
- 用时：`03:24`（实时更新）

**样式**：
- 标签（label）：灰色小字
- 数值（value）：加粗黑色

### 3.4 控制按钮组
**布局**：垂直排列，按钮间距 12px

| 按钮 | 图标 | 主次 | 状态管理 |
|------|------|------|----------|
| 新游戏 | 🎮 | 主按钮 | 始终可用 |
| 悔棋 | ↩️ | 次要 | EvE 禁用；无历史禁用 |
| 切换模式 | 🔄 | 次要 | 始终可用 |
| 保存棋局 | 💾 | 次要 | 有记录时启用 |
| 加载棋局 | 📁 | 次要 | 始终可用 |
| 棋局回放 | ⏯️ | 次要 | 有记录时启用 |

**交互**：
- 鼠标悬停：背景色加深 10%
- 点击：按钮缩放动画 (scale(0.95))
- 禁用：灰色 + cursor: not-allowed

### 3.5 AI 设置面板
**PvE 模式**：
```html
<div class="ai-settings">
  <label>AI 难度:</label>
  <select id="ai-difficulty">
    <option value="BEGINNER">新手</option>
    <option value="NORMAL" selected>正常</option>
    <option value="HARD">困难</option>
    <option value="HELL">地狱</option>
  </select>
</div>
```

**EvE 模式**：
```html
<div class="eve-ai-settings">
  <label>黑方 AI:</label>
  <select id="black-ai-difficulty">...</select>
  <label>白方 AI:</label>
  <select id="white-ai-difficulty">...</select>
</div>
```

**动态显示逻辑**：
- PvP 模式：隐藏整个 AI 设置面板
- PvE 模式：显示单一 AI 难度选择器
- EvE 模式：显示双 AI 难度选择器

### 3.6 提示信息区域
**位置**：棋盘下方，宽度与棋盘对齐

**样式**：
- 默认：浅灰色背景，灰色文字
- 警告：橙色边框，橙色文字
- 错误：红色边框，红色文字
- 成功：绿色边框，绿色文字

**内容示例**：
- `点击棋盘开始游戏`
- `⚠️ 三三禁手！黑棋不能在此位置落子`
- `✅ 黑棋获胜！`
- `AI 思考中…`

**动画**：
- 淡入淡出（0.3s）
- 错误提示时可添加震动效果

---

## 4. 交互流程规范

### 4.1 落子流程
1. 用户点击棋盘空位
2. 坐标转换（屏幕 → 网格）
3. 验证落子合法性
   - 坐标范围校验
   - 位置占用检测
   - 禁手检测
4. 合法：播放落子动画 + 更新状态
5. 非法：显示错误提示 + 震动效果（可选）

### 4.2 模式切换流程
1. 用户点击 "切换模式" 按钮
2. 弹出模式选择弹窗（或循环切换）
3. 确认切换后：
   - 清空棋盘
   - 重置计时器
   - 根据模式动态显示/隐藏 AI 设置
   - 更新状态面板文案

### 4.3 AI 思考流程
1. 触发 AI 计算
2. 禁用棋盘点击事件
3. 显示 "AI 思考中…" + Loading 动画
4. AI 计算完成后：
   - 自动落子
   - 高亮 AI 建议点（可选）
   - 恢复棋盘可点击
   - 更新提示信息

### 4.4 禁手提示流程
1. 检测到禁手
2. Canvas 绘制红色圆圈高亮
3. HUD 显示禁手类型与说明
4. 1.8 秒后自动消失，或用户点击其他位置时清除

### 4.5 游戏结束流程
1. 检测到胜负或平局
2. 标记游戏状态为 `finished`
3. 禁用所有游戏操作按钮（除 "新游戏"）
4. 弹出结果对话框：
   - 获胜方头像/棋子
   - 获胜信息
   - 步数、用时统计
   - 可选操作：保存棋谱、回放、新游戏

---

## 5. 动画与特效

### 5.1 落子动画
```css
@keyframes piece-drop {
  0% { transform: scale(0) translateY(-20px); opacity: 0; }
  60% { transform: scale(1.1) translateY(0); opacity: 1; }
  100% { transform: scale(1); }
}
```
**触发时机**：落子成功后  
**持续时长**：0.3s

### 5.2 最后落子光晕
- 使用 Canvas 渐变绘制（radialGradient）
- 黑棋：内部黑色 → 外部金色（rgba(255,215,0,0.6)）
- 白棋：内部白色 → 外部粉色（rgba(255,105,180,0.6)）
- 附加脉冲动画（可选）

### 5.3 Loading 动画
```css
.loading-dots span {
  animation: bounce 1.4s infinite ease-in-out both;
}
.loading-dots span:nth-child(1) { animation-delay: -0.32s; }
.loading-dots span:nth-child(2) { animation-delay: -0.16s; }

@keyframes bounce {
  0%, 80%, 100% { transform: scale(0); }
  40% { transform: scale(1); }
}
```

### 5.4 按钮点击反馈
```css
.btn:active {
  transform: scale(0.95);
  transition: transform 0.1s;
}
```

---

## 6. 无障碍（Accessibility）支持

### 6.1 键盘导航
- 棋盘需支持 `tabindex="0"` 和焦点高亮
- 方向键：移动焦点位置
- Enter / Space：在焦点位置落子
- Esc：取消当前操作

### 6.2 ARIA 属性
```html
<canvas 
  id="game-canvas" 
  role="grid" 
  aria-label="五子棋棋盘，15x15网格"
  tabindex="0">
</canvas>

<div class="hint-message" role="status" aria-live="polite">
  提示信息
</div>
```

### 6.3 屏幕阅读器支持
- 关键操作需提供 `aria-label`
- 状态变化需通过 `aria-live` 区域通知
- 按钮禁用需添加 `aria-disabled="true"`

---

## 7. 弹窗与对话框

### 7.1 游戏结束弹窗
**样式**：
- 居中遮罩层（半透明黑色背景）
- 白色卡片，圆角 8px，阴影效果
- 标题区：胜方信息（如 "🎉 黑棋获胜"）
- 内容区：统计数据（步数、用时）
- 按钮区：新游戏、保存棋谱、回放

**交互**：
- 点击遮罩层不关闭
- 点击关闭按钮/新游戏按钮关闭

### 7.2 设置对话框
**内容**：
- 禁手规则开关
- 提示功能开关
- 坐标轴显示开关
- 音效开关（可选）

**样式**：与游戏结束弹窗一致

### 7.3 帮助文档弹窗
**内容**：
- 游戏规则介绍
- 禁手规则说明
- 快捷键列表

---

## 8. 回放控制器（音乐播放器风格）

**位置**：页面底部，全宽  
**显示条件**：仅在回放模式下显示

**组件**：
```
┌────────────────────────────────────────────────┐
│ ⏮️ ◀️ ▶️ ⏭️  [进度条]  第5/12步  1.0x 速度  ❌ │
└────────────────────────────────────────────────┘
```

**按钮功能**：
- ⏮️ 跳到开始
- ◀️ 单步后退
- ▶️ / ⏸ 播放/暂停
- ⏭️ 跳到结束
- 1.0x 速度调节（0.5x / 1.0x / 2.0x）
- ❌ 退出回放

**进度条交互**：
- 拖动滑块跳转到指定步数
- 点击进度条某位置跳转

---

## 9. 性能优化建议

### 9.1 Canvas 优化
- 仅重绘变化区域（脏区域标记）
- 复杂图形预渲染到离屏 Canvas
- 减少状态切换（fillStyle, strokeStyle）

### 9.2 DOM 优化
- 使用 `documentFragment` 批量插入元素
- 避免频繁 reflow（读写分离）
- 事件委托（在父容器监听点击）

### 9.3 动画优化
- 优先使用 CSS 动画而非 JS
- 使用 `requestAnimationFrame` 而非 setTimeout
- 动画属性优先使用 `transform` 和 `opacity`（GPU 加速）

---

## 10. 设计资源与样式库

### 10.1 推荐图标库
- Emoji（原生支持，无需加载）
- Font Awesome（可选，需引入）

### 10.2 参考样式框架
- 无需引入完整框架，参考设计规范自行实现
- 可参考 Material Design / Ant Design 的组件风格

### 10.3 旧项目 CSS 资源
- `css/style.css`：完整样式定义
- `css/animations.css`：动画库

---

## 11. 开发检查清单

- [ ] 棋盘居中对齐，缩放适配不同屏幕
- [ ] 所有按钮禁用状态正确响应
- [ ] 提示信息颜色与类型对应
- [ ] AI 思考时禁用操作
- [ ] EvE 模式玩家无法操作
- [ ] 模式切换时 UI 正确更新
- [ ] 回放控制器功能完整
- [ ] 键盘导航支持（焦点可见）
- [ ] 屏幕阅读器兼容
- [ ] 移动端触摸操作流畅

---

> 本规范汇总了旧项目 UI 实现要点，并提供可落地的组件设计、交互流程与无障碍支持方案，适合作为前端开发的权威参考。